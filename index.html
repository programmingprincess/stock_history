<!DOCTYPE html>
<html lang="en">
<style>
    table {
      font-family: "Courier New", Courier, monospace;
      border-collapse: collapse;
      width: 100%;
    }
    
    th, td {
      text-align: left;
      padding: 8px;
    }
    
    tr:nth-child(even){background-color: #f2f2f2}
    
    th {
      background-color: #4CAF50;
      color: white;
    }
    </style>
<head>
    <meta charset="UTF-8">
    <title>Spatial Composition</title>
    <script src="Chart.min.js"></script>
    <script src="utils.js"></script>
    <link href="style.css" rel="stylesheet" type="text/css">

</head>
<body>
<h1 class = "title">Stock History </h1>


<h3>1. Select a tree: </h3>
<select id="tree-dropdown" onchange="updateTreeSelection(this)">
  <option value="msft" id="tree0">Tree 0</option>
  <option value="aapl" id="tree1">Tree 1</option>
  <option value="crm" id="tree2">Tree 2</option>
  <option value="tree3" id="tree2">Tree 3</option>
</select>
  <div style="width:75%;">
    <canvas id="canvas"></canvas>
  </div>
  <br>
  <br>
  <button id="randomizeData">Randomize Data</button>
  <button id="addDataset">Add Dataset</button>
  <button id="removeDataset">Remove Dataset</button>
  <button id="addData">Add Data</button>
  <button id="removeData">Remove Data</button>

<h3>1. Find relevant news: </h3>
Company: <input type="text" id="myText" value="Company name">
Date: <input type="text" id="myDate" value="YYYY-MM-DD">
<button onclick = "callNewsAPI()"> Find results</button>



<div id="printme"></div>
<div class="col-md-6">
  <table id="firstTabOverall">
      <thead>
          <th>Source</th>
          <th>Title</th>
          <th>Description</th>
      </thead>
      <tbody>
        <tr></tr>
      </tbody>
  </table>
</div>

</body>
<script type="text/javascript" src="main.js"></script>
<script>
var getJSON = function(url, callback) {
    var xhr = new XMLHttpRequest();
    xhr.open('GET', url, true);
    xhr.responseType = 'json';
    xhr.onload = function() {
      var status = xhr.status;
      if (status === 200) {
        callback(null, xhr.response);
      } else {
        callback(status, xhr.response);
      }
    };
    xhr.send();
};
//api keys 
// 1. open: "152.4100"
// 2. high: "163.7100"
// 3. low: "152.0000"
// 4. close: "162.0100"
// 5. adjusted close: "162.0100"
// 6. volume: "96388312"
// 7. dividend amount: "0.0000"
// 8. split coefficient: "1.0000"

var dow="";

getJSON('https://www.alphavantage.co/query?function=TIME_SERIES_DAILY_ADJUSTED&symbol=DOW&apikey=APIKEY',
function(err, data) {
  if (err !== null) {
    console.log('Something went wrong while parsing your JSON API:' + err);
  } else {
    series=data["Time Series (Daily)"];
    var dates = [];
    var prices= [];

    for (var time in series) {
      dates.push(time);
      prices.push(series[time]["4. close"]);
    }

    graphme(dates, prices);
    dow=prices;
  }
    
});



updateTreeSelection = function(dropdown) {
    tree_id=dropdown.value;
    idx=tree_id.substring(4);
    idx=parseInt(idx);
    

    getJSON('https://www.alphavantage.co/query?function=TIME_SERIES_DAILY_ADJUSTED&symbol=MSFT&apikey=APIKEY',
    function(err, data) {
      if (err !== null) {
        console.log('Something went wrong while parsing your JSON API:' + err);
      } else {
        series=data["Time Series (Daily)"];
        var dates = [];
        var prices= [];

        for (var time in series) {
          dates.push(time);
          prices.push(series[time]["4. close"]);
        }

        graphme(dates, dow, prices);
      }
        
    });
    // document.getElementById("printme").innerHTML = "LOl" + idx;

callNewsAPI = function(dropdown) {
    searchTerm = document.getElementById("myText").value;
    date = document.getElementById("myDate").value;
    // searchTerm = dropdown.value;


    var url = 'http://newsapi.org/v2/everything?' +
              'q='+searchTerm+'&' +
              // 'to=2020-01-18&' +
              // 'to=2020-01-18&' +
              'from='+date+'&' +
              'to='+date+'&' +
              'sortBy=popularity&';

    var req = new Request(url);
    var res = ""
    fetch(req)
        .then(function(response) {
          return response.json();
        }).then(response=>{
          // debugger
          res = response.articles[0].description;
          // debugger
          console.log(res);
          // document.getElementById("printme").innerHTML = res;
          var table = document.getElementById("firstTabOverall");
          debugger
          var childNodes = document.getElementById("firstTabOverall").childNodes[3];
          var new_tbody = document.createElement('tbody');
          // helper function        
          function addCell(tr, text) {
                  var td = tr.insertCell();
                  td.innerHTML = text;
                  return td;
              }

          var set1 = new Set(); 
          // insert data
          response.articles.forEach(function (article) {

              var tit = article.title;
              var yooareel = tit.link(article.url);
              if(!set1.has(article.source.name)){
                var row = new_tbody.insertRow();
                addCell(row, article.source.name);
                addCell(row, yooareel);
                addCell(row, article.description);
                set1.add(article.source.name);
              }

          });
          childNodes.parentNode.replaceChild(new_tbody, childNodes)
        })
}

</script>

</html>
